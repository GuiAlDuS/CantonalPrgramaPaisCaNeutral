---
title: "Analisis de los datos cantonales del piloto del Programa País Carbono Neutral"
author: "Guillermo Durán Sanabria"
date: "12/6/2018"
output: 
  html_document:
  toc: true
---

En este tutorial se trabajará con las tablas resultado del piloto del **Programa País Carbono Neutralidad categoría cantonal**, suministrados por la Dirección de Cambio Climático (DCC) del Ministerio de Ambiente y Energía (MINAE).

La tabla contiene datos del inventario de emisiones de gases de efecto invernadero realizado en los cantones de **Belén**, **San José**, **Golfito**, **La Unión**, **Desamparados** y **Monteverde**. Más información sobre el proyecto que generó estos datos puede accederse en el sitio web de la DCC.

Los paquetes que se utilizarán en el análisis son:
```{r message=FALSE, warning=FALSE}
library(tidyverse)
```


## Lectura de la tabla de datos
La tabla con los datos de los cantones pueden accederse en este enlace.

```{r}
tablaGeneral <- read_csv("TablaGeneralCantones.csv")
```

La tabla tabla cuenta con siete columnas:
- *aNo*: es el año en que se tomaron las mediciones
- *Canton*: cantón que reporta
- *Sector*: sector energético

### Resumen de variables:
Total de Sectores generales:
```{r}
tablaGeneral %>% group_by(Sector) %>% summarise()
```

Total de sectores específicos:
```{r}
tablaGeneral %>% group_by(`Específico`) %>% summarise()
```

Número de sectores específicos por sectores generales:
```{r}
tablaGeneral %>% group_by(Sector, `Específico`) %>% summarise() %>% group_by(Sector) %>% summarise(n())
```


Corrección de nombres de columnas y tipos de datos en las columnas:
```{r}
tablaGeneral <- tablaGeneral %>% 
  mutate(
    Esp = `Específico`,
    Alc1 = as.numeric(`Alcance 1 (ton CO2 eq)`),
    Alc2 = as.numeric(`Alcance 2 (ton CO2 eq)`),
    Alc3 = as.numeric(`Alcance 3 (ton CO2 eq)`))
```

## Gráficos

Los gráficos se generarán con la interface de R para la libraría de Python llamada Altair, una excelente librería para crear gráficos interactivos.

Total de emisiones de *alcance 1* por cantón en valores reales (toneladas) y normalizados:
```{r}
library("altair")

graficoTot <- 
  alt$Chart(tablaGeneral)$
  mark_bar()$
  encode(
    y = "Canton",
    x = "Alc1:Q",
    color = "Sector",
    tooltip = c("Esp", "Sector", "Alc1", "Alc2")
  )

graficoNor <- 
  alt$Chart(tablaGeneral)$
  mark_bar()$
  encode(
    x = alt$X2("sum(Alc1)", stack="normalize"),
    y = "Canton",
    color = "Sector",
    tooltip = c("Esp", "Sector", "Alc1", "Alc2")
  )

graficoTot & graficoNor
```

Ahora los gráficos de emisiones de *alcance 1* por sectores generales y específicos, mostrando los cantones con colores:
```{r}
graficoEsp <- 
  alt$Chart(tablaGeneral)$
  mark_bar()$
  encode(
    y = "Esp",
    x = "Alc1:Q",
    color = alt$Color("Canton", scale=alt$Scale(scheme="dark2")),
    tooltip = "Esp"
  )

graficoSec <- 
  alt$Chart(tablaGeneral)$
  mark_bar()$
  encode(
    y = "Sector",
    x = "Alc1:Q",
    color = "Canton"
  )

graficoSec & graficoEsp
```

Dadas las opciones de interactividad que brinda **Altair** podríamos hacer un gráfico interactivo donde al hacer click a la barra del cantón nos muestre los valores desagregados.

El código sería el siguiente:
```{r}

```

Condicionar por población:

```{r}
library("altair")
vega_data <- import_vega_data()

brush <- alt$selection(type = "interval", resolve="global")

base <- 
  alt$Chart(vega_data$cars())$
  mark_point()$
  encode(
    y="Miles_per_Gallon",
    color=alt$condition(brush, "Origin", alt$ColorValue("gray"))
  )$
  properties(selection = brush, width = 250, height=250)

chart <- (base$encode(x = "Horsepower") | base$encode( x = "Acceleration"))

chart
```
